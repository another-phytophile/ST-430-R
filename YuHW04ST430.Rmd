---
title: "Hw05ST430Yu"
author: "Haozhe (Jerry) Yu"
date: "`r Sys.Date()`"
output: 
  pdf_document:
    latex_engine: xelatex
---

```{r setup, include=FALSE}
library(tidyverse)
library(ggpmisc)
library(dplyr)
library(tidyverse)
library(tinytex)
library(usethis)
library(lmtest)
library(car)
library(rsq)
ftest = function(model, L, h = 0)
  # General linear test of H0: L beta = h
{
  BetaHat = model$coefficients
  dimL = dim(L)
  if (length(BetaHat) != dimL[2])
    stop("Sizes of L and Beta are incompatible")
  r = dimL[1]
  if (qr(L)$rank != r)
    stop("Rows of L must be linearly independent.")
  out = numeric(4)
  names(out) = c("F", "df1", "df2", "p-value")
  dfe = df.residual(model)
  diff = L %*% BetaHat - h
  fstat = t(diff) %*% solve(L %*% vcov(model) %*% t(L)) %*% diff / r
  # Note vcov = MSE * XtXinv
  fstat = as.numeric(fstat)
  out[1] = fstat
  out[2] = r
  out[3] = dfe
  out[4] = 1 - pf(fstat, r, dfe)
  return(out)
} # End of function ftest
```

# Question 1

> Problem1A: For this problem, use the Commercial Property data set from KNNL Problem 6.18. The response variable is rental rates. The explanatory variables are age, operating  expenses and taxes, vacancy rates, and total square footage.


```{r import 1}
Property <- as_tibble(read_table("https://users.stat.ufl.edu/~rrandles/sta4210/Rclassnotes/data/textdatasets/KutnerData/Chapter%20%206%20Data%20Sets/CH06PR18.txt",
            col_names = c("rrate","age","opex","tax","sqft")
            ))
```

## 1. Obtain a scatterplot matrix for all 5 variables (age, operating expenses and taxes, vacancy rates, total square  footage, and rental rates) and give your comments about linearity of variables.

```{r pplot}
pairs(Property)
```

Most of the variables seem lack linearity, except for sqft, which seems to positively linearly correlated with rental rate and operating expense, Rental Rate seems to also show a weak positive linear correlation with operating expense. 

## Find the correlation of all pairs of variables and give  your comments about the association between variables.

```{r cor}
PropertyCor <- cor(Property)
PropertyCor
```

My observations seem to be borne out, as the largest correlations (abs value) seem to be between rental rate and operating expenses (`r PropertyCor[3,1]`), rental rate and square footage ( `r PropertyCor[5,1]`), and square footage and operating expenses ( `r PropertyCor[3,5]`).

## 3) Run the multiple regressions with age, operating expenses and taxes, vacancy rates, and total square footage as the  explanatory variables and rental rates as the response variable.

```{r MLR}
Propertym <- lm(rrate~age + opex + tax + sqft,Property)
```

 
### a) Give the fitted (Estimated) regression equation.

Rental Rate ($Y_i$) = `r round(summary(Propertym)$coeff[1,1],3)`($beta_0$) + `r round(summary(Propertym)$coeff[2,1],3)`age($beta_1$)  + `r round(summary(Propertym)$coeff[3,1],3)`Operating_Expenses($beta_2$) + `r round(summary(Propertym)$coeff[4,1],3)`Tax($beta_3$) + `r summary(Propertym)$coeff[5,1]`Square_Footage($beta_4$)

### b) Interpret the estimated parameters in the context of the problem

For each incremental increase in Age, holding all other variables constant, there is a `r round(summary(Propertym)$coeff[2,1],3)` decrease in rental rate.

For each incremental increase in Operating Expenses, holding all other variables constant, there is a  `r round(summary(Propertym)$coeff[3,1],3)`increase in rental rate.

For each incremental increase in Tax, holding all other variables constant, there is a `r round(summary(Propertym)$coeff[4,1],3)` decrease in rental rate.

For each increase in 100,000 Square Feet, holding all other variables constant, there is a `r round(summary(Propertym)$coeff[5,1]*100000,3)` increase in rental rate.

### c) Give the value of R2 and Adj R2

$r^2$ = `r summary(Propertym)$r.sq`

$r^2_{adj}$ = `r summary(Propertym)$adj.r.sq`

### d) Give the results of the significance test for the null hypothesis that the four regression coefficients for the explanatory variables are all zero. Be sure to give the null and alternative hypotheses, the test 
statistic and its associated degrees of freedom, the  p-value, and a brief conclusion in words.

```{r ptable}
summary(Propertym) 
# Propertytable <- pigs %>% select(Drug, D_2, D_3) %>% distinct() %>%
#   
#   add_column("E(Y|x)" = c(
#     paste0(
#       round(summary(pigsm)$coefficients[1, 1], 3),
#       " + ",
#       round(summary(pigsm)$coefficients[2, 1], 3),
#       "*Momweight + ",
#       round(summary(pigsm)$coefficients[3, 1], 3),
#       "*Dadweight"
#     ),
#     paste0(
#       round(
#         summary(pigsm)$coefficients[1, 1] + summary(pigsm)$coefficients[4, 1],
#         3
#       ),
#       " + ",
#       round(summary(pigsm)$coefficients[2, 1], 3),
#       "*Momweight + ",
#       round(summary(pigsm)$coefficients[3, 1], 3),
#       "*Dadweight"
#     ),
#     paste0(
#       round(
#         summary(pigsm)$coefficients[1, 1] + summary(pigsm)$coefficients[5, 1],
#         3
#       ),
#       " + ",
#       round(summary(pigsm)$coefficients[2, 1], 3),
#       "*Momweight + ",
#       round(summary(pigsm)$coefficients[3, 1], 3),
#       "*Dadweight"
#     )
#   )
#   )
# 
# ptable
```
 
